<include file="public@header" />
</head>
<body>
	<div class="wrap">
		<ul class="nav nav-tabs">
			<li class="active"><a >列表</a></li>
			<li><a href="{:url('Liveing/add')}">{:lang('ADD')}</a></li>										  
		</ul>
		
		<form class="well form-inline margin-top-20" method="post" action="{:url('Liveing/index')}">
			时间：
			<input class="form-control js-bootstrap-date" name="start_time" id="start_time" value="{:input('request.start_time')}" aria-invalid="false" style="width: 110px;"> - 
            <input class="form-control js-bootstrap-date" name="end_time" id="end_time" value="{:input('request.end_time')}" aria-invalid="false" style="width: 110px;">
			关键字：
            <input class="form-control" type="text" name="uid" style="width: 200px;" value="{:input('request.uid')}"
                   placeholder="请输入会员ID">
			<input type="submit" class="btn btn-primary" value="搜索">
		</form>		
		<form method="post" class="js-ajax-form" >
			<table class="table table-hover table-bordered">
				<thead>
					<tr>
						<th>会员ID</th>
						<th>会员昵称</th>
						<th>标识</th>
						<th>开始时间</th>
						<th>类型</th>
						<th>标题</th>
						<th>封面</th>
						<th width="10%">描述</th>
						<th>在线人数</th>
						<th>累计人数</th>
						<th>播流地址</th>
						<!-- <th width="10%">设备信息</th> -->
						<th>操作</th>
					</tr>
				</thead>
				<tbody>
					<foreach name="lists" item="vo">
					<tr>
						<td>{$vo.uid}</td>					
						<td>{$vo['userinfo']['user_nickname']} </td>
						<td>{$vo['showid']}</td>
						<td>{:date('Y-m-d H:i',$vo['starttime'])}</td>
                        <td>{$vo['type_val']}</td>
                        <td>{$vo['title']}</td>
                        <td><img class="imgtip" src="{$vo['thumb']}" style="max-width:100px;max-height:100px;"></td>
                        <td style="word-break:break-all">{$vo['des']}</td>
                        <td>{$vo['nums']}</td>
                        <td>{$vo['totalnums']}</td>
                        <td style="word-break:break-all">{$vo['pull']}</td>
                        <!-- <td style="word-break:break-all">{$vo['deviceinfo']}</td> -->
						<td>
							<if condition="$vo['isvideo']==1">
								<a class="btn btn-xs btn-primary" href='{:url("Liveing/edit",array("uid"=>$vo["uid"]))}'>{:lang('EDIT')}</a>
							
								<a class="btn btn-xs btn-danger js-ajax-delete-live" data-uid="{$vo['uid']}" data-stream="{$vo['stream']}">关闭</a>
                            </if> 
						</td>
					</tr>
					</foreach>
				</tbody>
			</table>
			<div class="pagination">{$page}</div>

		</form>
	</div>
    <div id="enlarge_images" style="position:fixed;display:none;z-index:2;"></div>
	<script src="__STATIC__/js/admin.js"></script>
	<script src="__STATIC__/js/socket.io.js"></script>
	
	<script type="text/javascript">
         var socket = new io("{$config['chatserver']}");
		
         $(".js-ajax-delete-live").on("click",function(){
			var uid=$(this).data("uid");
			var stream=$(this).data("stream");
			
            $.ajax({
                url:'{:url('Liveing/del')}',
                data:{uid:uid},
                type:'POST',
                dataType:'json',
                success:function(data){
                    if(data.code==0){
                        alert(data.msg);
                        return !1;
                    }
                    var data2 = {"token":"1234567","uid":uid,"stream":stream};
                   
                    socket.emit("systemcloselive",data2);
                    alert("关闭聊天室成功");
					location.reload();
                }
            })
         
         })
    </script>
</body>
</html>