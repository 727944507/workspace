<include file="public@header" />
</head>
<link rel="stylesheet"  type="text/css" href="__STATIC__/js/layer/theme/default/layer.css"></script>
<body>
	<div class="wrap">
		<ul class="nav nav-tabs">
			<li class="active"><a >列表</a></li>
		</ul>
        
        <form class="well form-inline margin-top-20" method="post" action="{:url('Refund/index')}">
            状态：
            <select class="form-control" name="status" style="width: 100px;">
                <option value=''>全部</option>
                <volist name="status" id="v">
                    <option value="{$key}" <if condition="input('request.status') neq '' && input('request.status') eq $key">selected</if>>{$v}</option>
                </volist>
            </select>
            退款时间：
            <input class="form-control js-bootstrap-date" name="start_time" id="start_time" value="{:input('request.start_time')}" aria-invalid="false" style="width: 110px;"> - 
            <input class="form-control js-bootstrap-date" name="end_time" id="end_time" value="{:input('request.end_time')}" aria-invalid="false" style="width: 110px;">
            退款用户ID：
            <input class="form-control" type="text" name="uid" style="width: 200px;" value="{:input('request.uid')}"
                   placeholder="退款用户ID">
            接单用户ID：
            <input class="form-control" type="text" name="touid" style="width: 200px;" value="{:input('request.touid')}"
                   placeholder="接单用户ID">
            订单ID：
            <input class="form-control" type="text" name="orderid" style="width: 200px;" value="{:input('request.orderid')}"
                   placeholder="动态ID">
            <input type="submit" class="btn btn-primary" value="搜索"/>
            <a class="btn btn-danger" href="{:url('Refund/index')}">清空</a>
        </form>
    
		<form method="post" class="js-ajax-form">
			<table class="table table-hover table-bordered">
				<thead>
					<tr>
						<th>订单ID</th>
						<th>退款用户</th>
						<th>接单用户</th>
						<th width="50%">内容</th>
						<th>状态</th>
						<th>退款时间</th>
						
						<th align="center">{:lang('ACTIONS')}</th>
					</tr>
				</thead>
				<tbody>
					<foreach name="list" item="vo">
					<tr>
						<td>{$vo['id']}</td>
						<td>{$vo['userinfo']['user_nickname']} ({$vo['uid']})</td>
						<td>{$vo['touserinfo']['user_nickname']} ({$vo['liveuid']})</td>
						<td>{$vo['refundinfo']['content']}</td>
						<td>{$status[$vo['status']]}</td>
                        <td>{:date('Y-m-d H:i',$vo['refundtime'])}</td>
						<td>
							<if condition="$vo['status'] eq '3' OR $vo['status'] eq '6'">
								<a class="btn btn-xs btn-success js-ajax-dialog-btn" href="{:url('Refund/setRefund',array('id'=>$vo['id'],'status'=>'5'))}" data-msg="确定同意退款吗？">同意退款</a>
								
								<a class="btn btn-xs btn-danger js-ajax-dialog-btn" href="{:url('Refund/setRefund',array('id'=>$vo['id'],'status'=>'4'))}" data-msg="确定拒绝退款吗？">拒绝退款</a>
							</if>
						
						</td>
					</tr>
					</foreach>
				</tbody>
			</table>
			<div class="pagination">{$page}</div>

		</form>
	</div>
	<input type="hidden"  id="_selectBanval" value="">
	<script src="__STATIC__/js/admin.js"></script>
	<script src="__STATIC__/js/layer/layer.js"></script>
	<script type="text/javascript">
		
		Wind.use('layer');
		/*禁止接单*/
		function setbanorder(touid,reportid){
			layer.open({
				type: 2,
				title: '禁单时长（小时）',
				shadeClose: true,
				shade: 0.8,
				area: ['30%', '26%'],
				btn:['确定','取消'],
				content: '/admin/userrepot/setbanorder.html&touid='+touid,
				btn1:function(index,layero){
					var selectBanval=$("#_selectBanval").val();
					//设置禁单时间
					$.ajax({
						url: '/admin/userrepot/setBan.html',
						type: 'POST',
						dataType: 'json',
						data: {touid:touid,selectBanval: selectBanval,reportid:reportid},
						success:function(data){
							var code=data.code;
							if(code!=0){
								layer.msg(data.msg);
								return;
							}
							layer.msg("设置成功",{icon: 1,time:1000},function(){
								layer.closeAll();
								location.reload();
							});
						},
						error:function(e){
							console.log(e);
						}
					});
					
				}
			}); 
		}
	</script>
</body>
</html>